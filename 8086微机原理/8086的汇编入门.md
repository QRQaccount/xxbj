# 基础概念

## 通用寄存器

通常8086CPU的寄存器都是16位肚饿，可以存放两个字节。AX,BX,CX,DX。这4个寄存器通常用于存放一般性的数据，称为通用寄存器。<br>为了与上一代计算机通用，这里的十六位数据都可以分为两个独立使用的8位寄存器使用，例如AX分为AH和AL。

## 字在寄存器中的储存

也是处于对兼容性的考虑，8086cpu可以处理两种数据。一种是字节(byte)由八位(bit)组成，另外一种是字(word)，由两个字节组成。

## 汇编指令示例

| 汇编指令      | 完成的操作                 |
|:---------:|:---------------------:|
| mov ax,18 | 将十八送入AX寄存器            |
| mov ah,78 | 将78送入寄存器AH            |
| add ax,8  | 将寄存器AX的数值加上8          |
| mov ax,bx | 将寄存器BX中的数据送入AX中       |
| add ax,bx | 将AX和BX中的数据加起来结果存放在AX中 |

注意在使用指令操作数据的时候两对象的位数不一致则无法进行操作

## 关于物理地址

所有的内存单元构成的储存空间是一个一维的线性数据空间，每一个内存单元都有唯一的内存地址。不同的CPU有不同的形成物理地址的方式。

## 16位结构的CPU

- 运算器一次最多可以处理16位的数据
- 寄存器的最大宽度位16位
- 寄存器和运算器之间的通路为16位

## 8086给出物理地址的方法

8086CPU有20位地址总线，可以传送20位地址，达到1MB的寻址能力。若在内部一次性处理，传输，暂时储存的地址为16位。若直接发送16位的地址，寻址能力只有64kb。8086由地址加法器合成位20位地址再一起发出。

1. CPU提供两个16位的地址。一个位段地址，一个位偏移地址。
2. 段地址和偏移地址通过内部的总线送入一个地址加法器的部件
3. 地址加法器将两个16位的地址合成一个20位的物理地址
4. 地址加法器通过内部总线将20位的物理地址送入输入输出控制电路
5. 输入输出控制电路将20位的物理地址送上输入输出控制电路
6. 通过外部的地址总线传送到储存器

物理地址加法器使用物理地址=段地址*16+偏移地址的方式描述地址

### 段的概念

段地址的划分来自于CPU的处理，我们既可以将10000H到1000H划分为一段，也可以将10000H～1007FH划分为一个段。根据编程的需求可以讲若干连续地址当做一个段，用段地址×16表示段的起始位置

> 注意
> 
> 1. 段的起始地址一定是16的整数倍
> 2. 一个段的长度最大为64k
> 3. 一个物理地址可以由多个段地址*16+偏移地址来找到

### 段寄存器

CS,IP两个段寄存器。指示了CPU当前要读取指令的地址。CS为代码段寄存器，IP为指令指针寄存器

### 修改CS,IP指令

使用`jump`段地址:偏移地址的指令来完成CS寄存器修改.通过`jump`某一个**合法寄存器**来修改IP的值

```asm
jump 2AE3:3
# CPU将从2AE33开始执行指令
```

```assembly
jump ax
#用于修改IP的值
```

## 寄存器（内存访问）

### 内存中的字

在CPU中使用十六位寄存器用于储存一个字,高八位储存高位数据，第八位储存低位数据。在内存单元中，一个单元存放一个字节，则一个字由两个连续的内存单元来存放。字单元:存放一字型数据的内存单位，由两个连续的内存单元组合而来

### DS和[address]

ds寄存器用于存放段地址，`[number]`用于表示一个内存单元,其中的数字number是内存的偏移地址

```assembly
mov bx,1000h
mov ds,bx
mov al,[0]
#将10000H中的数据读到al
```

### 字的传送

8086是十六位结构可以直接传送16位的字

### CPU提供的栈机制

8086提供以栈的方式来访问内存空间的指令，8086提供出栈`pop`和入栈`push`指令

```assembly
pop ax
#将栈顶送入ax
push ax
#将寄存器ax中的数值放入栈顶
```

同时，任意时刻**SS:SP指向栈顶元素**，在执行pop和push的时候CPU都可以获得栈顶的位置。当栈空的时候，因为SS:SP始终指向栈顶，此时没有栈元素的话则只能指向栈底部的元素的后的字单元(即字单元的偏移量+2)

> 注意8086会记录堆栈的栈顶位置，但不会记录栈的大小，当栈顶越界时，会覆盖掉栈外的数据

### 栈段

CPU可以将一组连续地址的内存单元当做一个段来进行处理，我们也可以将一个内存中的段当作一个栈空间

## 常用的8086指令

1. mov
   1. 将数据直接送入寄存器
   2. 将一个寄存器中的内容送到另一个寄存器
2. add
3. adc 考虑进位的加法
4. jump
5. loop
6. in IO输入
7. out IO输出
8. push 压栈指令
9. pop 出栈指令

## 常用的8086寄存器

1. ax(ah,al) 通用寄存器,累加器
2. bx(bh,bl) 通用寄存器,基址寄存器
3. cx(ch,cl) 通用寄存器,
4. dx(dh,dl)
5. cf 表示进位
6. BP堆栈段的访问
7. SP堆栈指针
