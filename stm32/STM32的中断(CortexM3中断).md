# STM32的中断

## Cortex-M3的中断

Cortex‐M3 支持大量异常，包括 16‐4‐1=11 个系统异常，和最多 240 个外部中断，由外设产生的中断
信号，除了 SysTick 的之外，全都连接到 NVIC (嵌套中断向量控制器，是ARM Cortex M3的内部设备之一)的中断输入信号线。作为中断功能的强化，NVIC 还有一条 NMI 输入信号线。NMI 究竟被拿去做什么，还要视处理器的设计而定。在多数情况下，NMI 会被连接到一个看门狗定时器，有时也会是电压监视功能块.

## 中断的配置

每个外部中断都在NVIC的下列寄存器中记录

> NVIC的寄存器中写0是无效的，只能对相反作用寄存器中写1由硬件自己来控制

- 使能与除能寄存器
- 悬起和解悬寄存器
- 优先级寄存器
- 活动状态储存器

同时，有一部分寄存器对中断行为由重要影响

- 异常掩蔽寄存器

- 向量表偏移寄存器

- 软件触发寄存器

- 优先级分组位段

在STM32中其中部分寄存器对应

- ISER[8]:中断使能寄存器组，由8个32位寄存器来控制，每个位控制一个中断，因为STM32只有68个中断实现，所以只有ISER[0～2]能够使用ISER[X]中的每一位用来控制32X+bit的那一个中断的使能
- ICER[8]：是一个中断除能寄存器组。该寄存器组与 ISER 的作用恰好相反，是用来清除某个中断的使能的。每一位与ISER对应
- ICPR[8]：个中断解挂控制寄存器组，对应位与ISER一致，将中断挂起
- IABR[8]:是一个中断激活标志位寄存器组。对应位所代表的中断和 ISER 一样，如果为 1，则表示该位所对应的中断正在被执行。这是一个只读寄存器，通过它可以知道当前在执行的中断是哪一个。在中断执行完了由硬件自动清零
- IP[240]：  是一个中断优先级控制的寄存器组。

> 关于悬起:
>
> 如果中断发生时，正在处理同级或高优先级异常，或者被掩蔽，则中断不能立即得到响应。此
> 时中断被悬起。中断的悬起状态可以通过“中断设置悬起寄存器(SETPEND)”和“中断悬起清除寄存器(CLRPEND)”来读取，还可以通过写它们来手工悬起中断